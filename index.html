<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title></title>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css"></script>
</head>
<body>
 <div class="container">
   <h1 class="text-center">Textmewhen</h1>
   <hr>
   <div class="page"></div>
 </div>

 <script type="text/template" id="job-template">


  <form class="create-job-form" >
  <label class="control-label"for="email">Email</label>
  <input class="form-control"type="text" name="email">
  <label class="control-label"for="price">Price</label>
  <input class="form-control"type="text" name="price">
<!--start-->
  <label class="control-label" for="start_location">Start Location:</label>
  <input class="form-control" type="text" name="start_location">
  <div class="panel panel-primary">
    <div class="panel-heading">
      <div class="panel-title">
        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapse-1" aria-expanded="true">Pickup Location Map</a>
      </div>
    </div>
    <div class="panel-collapse collapse in" id="collapse-1" aria-expanded="true">
      <div class="panel-body" id="from_map" style="width: 100%; height: 300px;" ></div>
    </div>
  </div>
<!--end-->

<!--start-->
  <label class="control-label" for="end_location">End Location:</label>
  <input class="form-control" type="text" name="end_location">
  <div class="panel panel-primary">
    <div class="panel-heading">
      <div  class="panel-title"> <a id="open_me" class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapse-2" aria-expanded="false">Destination Map</a>
      </div>
    </div>
    <div class="panel-collapse collapse in" id="collapse-2" aria-expanded="false">
      <div class="panel-body" id="to_map" style="width: 100%; height: 300px;"></div>
    </div>
  </div>
<!--end-->
  <input type="hidden" name="start_lon">
  <input type="hidden" name="start_lat">
  <input type="hidden" name="end_lon">
  <input type="hidden" name="end_lat">
  <hr>
  <button class="btn btn-lg btn-block btn-primary" type="submit">Submit</button>
</form>
<hr>
 </script>

 <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> 
 <script src="js/locationpicker.jquery.js"></script>
 <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
 <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
 <script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script>
 <script type="text/javascript" src='http://maps.google.com/maps/api/js?sensor=false&libraries=places'></script>

 <script type="text/javascript">
  (function ($) {

  $.fn.serializeObject = function()
  {
      var o = {};
      var a = this.serializeArray();
      $.each(a, function() {
          if (o[this.name] !== undefined) {
              if (!o[this.name].push) {
                  o[this.name] = [o[this.name]];
              }
              o[this.name].push(this.value || '');
          } else {
              o[this.name] = this.value || '';
          }
      });
      return o;
  };

  startMapWithGeolocation = function (callback) {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function (position) {
        callback({ latitude: position.coords.latitude, longitude: position.coords.longitude });
      }, function () {
        callback({ latitude: 40.782865, longitude: -73.965354 });
      });
    } else {
        callback({ latitude: 40.782865, longitude: -73.965354 });
    }
  }
  window.onload = startMapWithGeolocation( function (geolocation) {
    $("#from_map").locationpicker({
      location: geolocation
      ,
      radius: 20,
      inputBinding: {
        locationNameInput: $('[name=start_location]'),
        latitudeInput: $("[name=start_lat]"),
        longitudeInput: $("[name=start_lon]")
      },
      enableAutocomplete: true,
      onchanged: function (currentLocation, radius, isMarkerDropped) {
        $("[name=start_lat]").val(currentLocation.latitude);
        $("[name=start_lon]").val(currentLocation.longitude);
      }
    });
    $("#to_map").locationpicker({
      location: {
        latitude: 40.782865,
        longitude: -73.965354
      },
      radius: 20,
      inputBinding: {
        locationNameInput: $('[name=end_location]'),
        latitudeInput: $("[name=end_lat]"),
        longitudeInput: $("[name=end_lon]")
      },
      enableAutocomplete: true,
      onchanged: function (currentLocation, radius, isMarkerDropped) {
        $("[name=end_lat]").val(currentLocation.latitude);
        $("[name=end_lon]").val(currentLocation.longitude);
      }
    });
  });
    var Job = Backbone.View.extend({
      el: '.page',
      render: function () {
        var template = _.template($("#job-template").html(), {} );
        this.$el.html(template);
      },
      events: {
        "submit .create-job-form": "saveJob",
      },
      saveJob: function (ev) {
        var jobDetails = $(ev.currentTarget).serializeObject();
        return false;
      }
    });

    var Router = Backbone.Router.extend({
      routes: {
        "": "home" }
    });

    var job = new Job();

    var router = new Router();
    router.on("route:home", function () {
      job.render();
    });

    Backbone.history.start();

  })(jQuery);
 </script>
</body>
</html>
